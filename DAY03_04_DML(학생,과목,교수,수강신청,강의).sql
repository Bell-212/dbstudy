--수강신청 데이터베이스 실습
--삭제는 생성의 역순
DROP TABLE LECTURE_TBL;
DROP TABLE ENROLL_TBL;
DROP TABLE STUDENT_TBL;
DROP TABLE COURSE_TBL;
DROP TABLE PROFESSOR_TBL;
/*
PK ONLY 교수/과목
교수-과목-학생-수강신청-강의 순으로 테이블 생성
교수번호, 학번, 과목번호 시퀀스 사용 지양. 순차적 번호가 결이 안맞기도 하고 자주 INSERT가 일어나지 않음을 예상. 
강의번호, 수강신청번호는 시퀀스 사용. 번호가 많이 필요함을 예상.
*/

CREATE TABLE PROFESSOR_TBL (
    PROF_NO    NUMBER            NOT NULL
  , PROF_NAME  VARCHAR2(15 BYTE) NOT NULL
  , PROF_MAJOR VARCHAR2(30 BYTE)
  , CONSTRAINT PK_PROF PRIMARY KEY(PROF_NO)
);

CREATE TABLE COURSE_TBL (
    COUR_NO    NUMBER            NOT NULL
  , COUR_NAME  VARCHAR2(30 BYTE) NOT NULL UNIQUE
  , COUR_SCORE VARCHAR2(10 BYTE) NOT NULL
  , CONSTRAINT PK_COUR PRIMARY KEY(COUR_NO)
);

CREATE TABLE STUDENT_TBL (
    STU_NO      NUMBER            NOT NULL
  , STU_NAME    VARCHAR2(15 BYTE) NOT NULL 
  , STU_ADDR    VARCHAR2(100 BYTE)
  , STU_GRADE   NUMBER(1)         NOT NULL
  , PROF_NO     NUMBER            
  , CONSTRAINT PK_STU PRIMARY KEY(STU_NO)
  , CONSTRAINT FK_PROF_STU FOREIGN KEY(PROF_NO) REFERENCES PROFESSOR_TBL(PROF_NO) ON DELETE SET NULL
);

CREATE TABLE ENROLL_TBL (
    ENR_NO    NUMBER NOT NULL
  , STU_NO    NUMBER NOT NULL
  , COUR_NO   NUMBER NOT NULL
  , ENR_DATE  DATE   NOT NULL
  , CONSTRAINT PK_ENR PRIMARY KEY(ENR_NO)
  , CONSTRAINT FK_STU_ENR FOREIGN KEY(STU_NO) REFERENCES STUDENT_TBL(STU_NO) ON DELETE CASCADE
  , CONSTRAINT FK_COUR_ENR FOREIGN KEY(COUR_NO) REFERENCES COURSE_TBL(COUR_NO) ON DELETE CASCADE
);

CREATE TABLE LECTURE_TBL (
    LEC_NO   NUMBER            NOT NULL
  , PROF_NO  NUMBER            NOT NULL
  , ENR_NO   NUMBER            NOT NULL
  , LEC_NAME VARCHAR2(30 BYTE) 
  , LOCATION VARCHAR2(30 BYTE) NOT NULL
  , CONSTRAINT PK_LEC PRIMARY KEY(LEC_NO)
  , CONSTRAINT FK_PROF_LEC FOREIGN KEY(PROF_NO) REFERENCES PROFESSOR_TBL(PROF_NO) ON DELETE CASCADE
  , CONSTRAINT FK_ENR_LEC FOREIGN KEY(ENR_NO) REFERENCES ENROLL_TBL(ENR_NO) ON DELETE CASCADE
);

INSERT INTO PROFESSOR_TBL(PROF_NO, PROF_NAME, PROF_MAJOR) VALUES(1, '김아무개', '수학');
INSERT INTO PROFESSOR_TBL(PROF_NO, PROF_NAME, PROF_MAJOR) VALUES(2, '이아무개', '국어');
INSERT INTO PROFESSOR_TBL(PROF_NO, PROF_NAME, PROF_MAJOR) VALUES(3, '박아무개', '영어');
COMMIT;

INSERT INTO COURSE_TBL(COUR_NO, COUR_NAME, COUR_SCORE) VALUES(10, '수학응용', 4);
INSERT INTO COURSE_TBL(COUR_NO, COUR_NAME, COUR_SCORE) VALUES(20, '국어응용', 4);
INSERT INTO COURSE_TBL(COUR_NO, COUR_NAME, COUR_SCORE) VALUES(30, '영어응용', 5);
COMMIT;

INSERT INTO STUDENT_TBL(STU_NO, STU_NAME, STU_ADDR, STU_GRADE, PROF_NO) VALUES(2222, '김김김', '서울', 2, 1);
INSERT INTO STUDENT_TBL(STU_NO, STU_NAME, STU_ADDR, STU_GRADE, PROF_NO) VALUES(3333, '이이이', '경기', 4, 3);
INSERT INTO STUDENT_TBL(STU_NO, STU_NAME, STU_ADDR, STU_GRADE, PROF_NO) VALUES(4444, '박박박', '강원', 1, 2);
COMMIT;

DROP SEQUENCE ENR_SEQ;
CREATE SEQUENCE ENR_SEQ
    ORDER;

INSERT INTO ENROLL_TBL(ENR_NO, STU_NO, COUR_NO, ENR_DATE) VALUES(ENR_SEQ.NEXTVAL, 3333, 10, '23/07/01');
INSERT INTO ENROLL_TBL(ENR_NO, STU_NO, COUR_NO, ENR_DATE) VALUES(ENR_SEQ.NEXTVAL, 2222, 30, '23/07/01');
INSERT INTO ENROLL_TBL(ENR_NO, STU_NO, COUR_NO, ENR_DATE) VALUES(ENR_SEQ.NEXTVAL, 4444, 20, '23/07/03');
COMMIT;

DROP SEQUENCE LEC_SEQ;
CREATE SEQUENCE LEC_SEQ
    START WITH 1000
    ORDER;
    
INSERT INTO LECTURE_TBL (LEC_NO, PROF_NO, ENR_NO, LEC_NAME, LOCATION) VALUES(LEC_SEQ.NEXTVAL, 1, 2, 'NOTHING', '101호');
INSERT INTO LECTURE_TBL (LEC_NO, PROF_NO, ENR_NO, LEC_NAME, LOCATION) VALUES(LEC_SEQ.NEXTVAL, 3, 1, 'IMPACT', '202호');
INSERT INTO LECTURE_TBL (LEC_NO, PROF_NO, ENR_NO, LEC_NAME, LOCATION) VALUES(LEC_SEQ.NEXTVAL, 2, 3, 'DRAMA', '303호');
COMMIT;
